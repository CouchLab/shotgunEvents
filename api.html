

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Plugins &mdash; Shotgun Events Daemon 0.9 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Shotgun Events Daemon 0.9 documentation" href="index.html" />
    <link rel="next" title="Technical Overview" href="techOverview.html" />
    <link rel="prev" title="Configuration" href="configuration.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="techOverview.html" title="Technical Overview"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="configuration.html" title="Configuration"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Shotgun Events Daemon 0.9 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="plugins">
<h1>Plugins<a class="headerlink" href="#plugins" title="Permalink to this headline">¶</a></h1>
<p>A plugin file is any <em>.py</em> file in a plugin path as specified in the config file.</p>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>A Shotgun event processing plugin has two main parts. A callback registration
function and any number of callbacks.</p>
<div class="section" id="registercallbacks-function">
<h3>registerCallbacks function<a class="headerlink" href="#registercallbacks-function" title="Permalink to this headline">¶</a></h3>
<p>To be loaded by the framework, your plugin should at least implement the
following function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">registerCallbacks</span><span class="p">(</span><span class="n">reg</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>This function will be used to tell the event processing system which functions
to call to process events.</p>
<p>This function should take one argument which is a <a class="reference internal" href="#Registrar" title="Registrar"><tt class="xref py py-class docutils literal"><span class="pre">Registrar</span></tt></a> object.</p>
<p>The <a class="reference internal" href="#Registrar" title="Registrar"><tt class="xref py py-class docutils literal"><span class="pre">Registrar</span></tt></a> has one critically important method:
<a class="reference internal" href="#Registrar.registerCallback" title="Registrar.registerCallback"><tt class="xref py py-meth docutils literal"><span class="pre">registerCallback()</span></tt></a>.</p>
<p>For each of your functions that should process Shotgun events, call
<a class="reference internal" href="#Registrar.registerCallback" title="Registrar.registerCallback"><tt class="xref py py-meth docutils literal"><span class="pre">registerCallback()</span></tt></a> once with the appropriate arguments.</p>
<p>You can register as many functions as you wish and not all functions in the file
need to be registered as event processing callbacks.</p>
</div>
<div class="section" id="callbacks">
<h3>Callbacks<a class="headerlink" href="#callbacks" title="Permalink to this headline">¶</a></h3>
<p>A callback that will be registered with the system must take four arguments:</p>
<ul class="simple">
<li>A Shotgun connection instance if you need to query Shotgun for additional
information.</li>
<li>A Python Logger object that should be used for reporting. Error and Critical
messages will be sent via email to any configured user.</li>
<li>The Shotgun event to be processed.</li>
<li>The <em>args</em> value passed in at callback registration time. (See <a class="reference internal" href="#Registrar.registerCallback" title="Registrar.registerCallback"><tt class="xref py py-meth docutils literal"><span class="pre">registerCallback()</span></tt></a>)</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">You can do whatever you want in a plugin but if any exception raises back to
the framework. The plugin within which the offending callback lives (and all
contained callbacks) will be deactivated until the file on disk is changed
(read: fixed).</p>
</div>
</div>
<div class="section" id="printing-out-information">
<h3>Printing out information<a class="headerlink" href="#printing-out-information" title="Permalink to this headline">¶</a></h3>
<p>Using the print statement in an event plugin is not recommended. It is prefered
you use the standard logging module from the Python standard library. A logger
object will be provided to your various functions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">registerCallbacks</span><span class="p">(</span><span class="n">reg</span><span class="p">):</span>
    <span class="n">reg</span><span class="o">.</span><span class="n">setEmails</span><span class="p">(</span><span class="s">&#39;root@domain.com&#39;</span><span class="p">,</span> <span class="s">&#39;tech@domain.com&#39;</span><span class="p">)</span> <span class="c"># Optional</span>
    <span class="n">reg</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Info&#39;</span><span class="p">)</span>
    <span class="n">reg</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Error&#39;</span><span class="p">)</span> <span class="c"># ERROR and above will be sent via email in default config</span>
</pre></div>
</div>
<p>and:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">exampleCallback</span><span class="p">(</span><span class="n">sg</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Info message&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If the event framework is running as a daemon this will be logged to a file
otherwise it will be logged to stdout.</p>
</div>
</div>
<div class="section" id="api">
<h2>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<div class="section" id="registercallbacks">
<h3>registerCallbacks<a class="headerlink" href="#registercallbacks" title="Permalink to this headline">¶</a></h3>
<p>A global level function in all plugins that is used to tell the framework about
event processing entry points in the plugin.</p>
<dl class="function">
<dt id="registerCallbacks">
<tt class="descname">registerCallbacks</tt><big>(</big><em>reg</em><big>)</big><a class="headerlink" href="#registerCallbacks" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>reg</strong> &#8211; The <a class="reference internal" href="#Registrar" title="Registrar"><tt class="xref py py-class docutils literal"><span class="pre">Registrar</span></tt></a> you will interact with to tell the framework which functions to call.</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="registrar">
<h3>Registrar<a class="headerlink" href="#registrar" title="Permalink to this headline">¶</a></h3>
<p>The object passed to the <a class="reference internal" href="#registerCallbacks" title="registerCallbacks"><tt class="xref py py-func docutils literal"><span class="pre">registerCallbacks()</span></tt></a> function.</p>
<dl class="class">
<dt id="Registrar">
<em class="property">class </em><tt class="descname">Registrar</tt><a class="headerlink" href="#Registrar" title="Permalink to this definition">¶</a></dt>
<dd><p>The Registrar is the object used to tell the framework how to interact with
a plugin.</p>
<dl class="method">
<dt id="Registrar.getLogger">
<tt class="descname">getLogger</tt><big>(</big><big>)</big><a class="headerlink" href="#Registrar.getLogger" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the python Logger object used to log messages from within the plugin.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can access this through the <a class="reference internal" href="#Registrar.logger" title="Registrar.logger"><tt class="xref py py-attr docutils literal"><span class="pre">logger</span></tt></a> property as well.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="Registrar.logger">
<tt class="descname">logger</tt><a class="headerlink" href="#Registrar.logger" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="#Registrar.getLogger" title="Registrar.getLogger"><tt class="xref py py-meth docutils literal"><span class="pre">getLogger()</span></tt></a>.</p>
</dd></dl>

<dl class="method">
<dt id="Registrar.setEmails">
<tt class="descname">setEmails</tt><big>(</big><em>* emails</em><big>)</big><a class="headerlink" href="#Registrar.setEmails" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the emails that should receive error and critical notices when
something bad happens in this plugin or any of its callbacks.</p>
<p>To send emails to default addresses as specified in the configuration file (default):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">reg</span><span class="o">.</span><span class="n">setEmails</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>To disable emails (this is not suggested as you won&#8217;t get error messages):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">reg</span><span class="o">.</span><span class="n">setEmails</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>To send emails to specific addresses use:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">reg</span><span class="o">.</span><span class="n">setEmails</span><span class="p">(</span><span class="s">&#39;user1@domain.com&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">reg</span><span class="o">.</span><span class="n">setEmails</span><span class="p">(</span><span class="s">&#39;user1@domain.com&#39;</span><span class="p">,</span> <span class="s">&#39;user2@domain.com&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Registrar.registerCallback">
<tt class="descname">registerCallback</tt><big>(</big><em>sgScriptName</em>, <em>sgScriptKey</em>, <em>callback</em>, <em>matchEvents=None</em>, <em>args=None</em><big>)</big><a class="headerlink" href="#Registrar.registerCallback" title="Permalink to this definition">¶</a></dt>
<dd><p>Register a callback into the engine for this plugin.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>sgScriptName</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; The name of the script taken from the Shotgun scripts page.</li>
<li><strong>sgScriptKey</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; The application key for the script taken from a Shotgun script page.</li>
<li><strong>callback</strong> (<em>A function or an object with a __call__ method.</em>) &#8211; A callable function that. See <a class="reference internal" href="#exampleCallback" title="exampleCallback"><tt class="xref py py-func docutils literal"><span class="pre">exampleCallback()</span></tt></a>.</li>
<li><strong>matchEvents</strong> (<a class="reference external" href="http://docs.python.org/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) &#8211; A filter of events you want to have passed to your callback.</li>
<li><strong>args</strong> &#8211; Any object you want the framework to pass back into your callback.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The <em>sgScriptName</em> is used to identify the plugin to Shotgun. Any name
can be shared across any number of callbacks or be unique for a single
callback.</p>
<p>The <em>sgScriptKey</em> is used to identify the plugin to Shotgun and should
be the appropriate key for the specified <em>sgScriptName</em>.</p>
<p>The specified <em>callback</em> object will be invoked when an event that
matches your filter needs processing. Although any callable should be
able to run, using a class here is not suggested. Use of a function or
an instance with a <em>__call__</em> method is more appropriate.</p>
<p>The <em>matchEvent</em> argument is a filter that allows you to specify which
events the callback being registered is interrested in. If <em>matchEvents</em>
is not specified or None is specified, all events will be passed to the
callback. Otherwise each key in the <em>matchEvents</em> filter is an
event_type while each value is a list of possible attribute_name:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">matchEvents</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;Shotgun_Task_Change&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;sg_status_list&#39;</span><span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can have multiple event_type or attribute_names:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">matchEvents</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;Shotgun_Task_Change&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;sg_status_list&#39;</span><span class="p">],</span>
    <span class="s">&#39;Shotgun_Version_Change&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;description&#39;</span><span class="p">,</span> <span class="s">&#39;sg_status_list&#39;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can filter on any event_type that has a given attribute_name:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">matchEvents</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;*&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;sg_status_list&#39;</span><span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can also filter on any attribute_name for a given event_type:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">matchEvents</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;Shotgun_Version_Change&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;*&#39;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Although the following is valid and functionally equivalent to
specifying nothing, it&#8217;s just really useless:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">matchEvents</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;*&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;*&#39;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <em>args</em> argument will not be used by the event framework itself but
will simply be passed back to your callback without any modification.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The point of the <em>args</em> argument is for you to be able to process
time consuming stuff in the <a class="reference internal" href="#registerCallbacks" title="registerCallbacks"><tt class="xref py py-func docutils literal"><span class="pre">registerCallbacks()</span></tt></a> function and
have it passed back to you at event processing time.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Another use of the <em>args</em> argument could be to pass in a common
mutable, say a <cite>dict</cite>, to multiple callbacks to have them share
data.</p>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="callback">
<h3>Callback<a class="headerlink" href="#callback" title="Permalink to this headline">¶</a></h3>
<p>Any plugin entry point registered by <a class="reference internal" href="#Registrar.registerCallback" title="Registrar.registerCallback"><tt class="xref py py-meth docutils literal"><span class="pre">Registrar.registerCallback()</span></tt></a> should
look like this.</p>
<dl class="function">
<dt id="exampleCallback">
<tt class="descname">exampleCallback</tt><big>(</big><em>sg</em>, <em>logger</em>, <em>event</em>, <em>args</em><big>)</big><a class="headerlink" href="#exampleCallback" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>sg</strong> &#8211; A Shotgun connection instance.</li>
<li><strong>logger</strong> &#8211; A Python logging.Logger object preconfigured for you.</li>
<li><strong>event</strong> (<a class="reference external" href="http://docs.python.org/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) &#8211; A Shotgun event to process</li>
<li><strong>args</strong> &#8211; The args argument specified at callback registration time.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Implementing a callback as a <em>__call__</em> method on an object instance is left
as an exercise to the user.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Plugins</a><ul>
<li><a class="reference internal" href="#overview">Overview</a><ul>
<li><a class="reference internal" href="#registercallbacks-function">registerCallbacks function</a></li>
<li><a class="reference internal" href="#callbacks">Callbacks</a></li>
<li><a class="reference internal" href="#printing-out-information">Printing out information</a></li>
</ul>
</li>
<li><a class="reference internal" href="#api">API</a><ul>
<li><a class="reference internal" href="#registercallbacks">registerCallbacks</a></li>
<li><a class="reference internal" href="#registrar">Registrar</a></li>
<li><a class="reference internal" href="#callback">Callback</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="configuration.html"
                        title="previous chapter">Configuration</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="techOverview.html"
                        title="next chapter">Technical Overview</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/api.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="techOverview.html" title="Technical Overview"
             >next</a> |</li>
        <li class="right" >
          <a href="configuration.html" title="Configuration"
             >previous</a> |</li>
        <li><a href="index.html">Shotgun Events Daemon 0.9 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Patrick Boucher.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>